image: orangecloudfoundry/orange-cf-bosh-cli

stages:
  - prebuild
  - build
  - deploy

prebuild:
  stage: prebuild
  script:
    - echo "Building $CI_PROJECT_NAME"
    - yarn
  cache:
    key: "$CI_JOB_NAME-$CI_COMMIT_REF_SLUG"

build-storybook:
  stage: build
  script: 
    - yarn run build-storybook
  artifacts:
    paths:
      - web-storybook/storybook-static

build-web:
  stage: build
  script:
    - yarn build
  artifacts:
    paths:
      - web/build

dev-storybook:
  stage: deploy
  script:
    - cf login -a $CF_URL -u $CF_USER -p $CF_PASS
    - cf target -o "$CF_ORG" -s $CF_SPACE
    - cf push storybook
  only:
    - dev
dev-web:
  stage: deploy
  script:
    - cf login -a $CF_URL -u $CF_USER -p $CF_PASS
    - cf target -o "$CF_ORG" -s $CF_SPACE
    - cf push registry
  only:
    - dev

production:
  stage: deploy
  script:
    - cf login -a $CF_URL -u $CF_USER -p $CF_PASS
    - cf target -o "$CF_ORG" -s $CF_SPACE
#   - cf push APP NAMES 
  only:
    - master